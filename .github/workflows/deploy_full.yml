name: Deploy Fullstack Project

on:
  # 1. Cho phÃ©p báº¥m nÃºt cháº¡y thá»§ cÃ´ng
  workflow_dispatch:

  # 2. Tá»± cháº¡y khi push code vÃ o nhÃ¡nh main
  push:
    branches:
      - main
      - master

jobs:
  deploy-all:
    name: ğŸš€ Build & Deploy
    runs-on: ubuntu-latest
    steps:
      # BÆ°á»›c 1: Láº¥y code tá»« GitHub vá» mÃ¡y chá»§ áº£o (Runner)
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      # BÆ°á»›c 2: Gá»™p Frontend vÃ  Backend vÃ o má»™t thÆ° má»¥c chung (tÃªn lÃ  FinalBuild)
      - name: ğŸ”¨ Merge Files
        run: |
          # Táº¡o thÆ° má»¥c chá»©a file chuáº©n bá»‹ upload
          mkdir FinalBuild

          # Copy toÃ n bá»™ file trong Frontend vÃ o FinalBuild
          cp -r Frontend/* FinalBuild/

          # Copy toÃ n bá»™ file trong Backend vÃ o FinalBuild
          cp -r Backend/* FinalBuild/

          # (TÃ¹y chá»n) Liá»‡t kÃª file ra mÃ n hÃ¬nh log Ä‘á»ƒ kiá»ƒm tra
          echo "Danh sÃ¡ch file chuáº©n bá»‹ upload:"
          ls -R FinalBuild/

      # BÆ°á»›c 3: Upload thÆ° má»¥c FinalBuild lÃªn htdocs cá»§a InfinityFree
      - name: ğŸ“‚ Sync to InfinityFree
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.IF_HOST }}
          username: ${{ secrets.IF_USER }}
          password: ${{ secrets.IF_PASS }}

          # Láº¥y code tá»« thÆ° má»¥c vá»«a gá»™p xong
          local-dir: ./FinalBuild/

          # Äáº©y vÃ o thÆ° má»¥c gá»‘c htdocs
          server-dir: htdocs/

          # KhÃ´ng xÃ³a cÃ¡c file khÃ¡c trÃªn host (cho an toÃ n)
          dangerous-clean-slate: false
